<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>fiberL: Computer Vision for Fiber Analysis – Jonathan Day | Portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0b37c64f34216b628666a8dac638b53b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Jonathan Day | Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="./fiberL.html">
 <span class="dropdown-text">fiberL - Fiber Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/lonespear/wuc_predict">
 <span class="dropdown-text">WUC Predictor - Aircraft Maintenance</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/lonespear/HedgeAbove">
 <span class="dropdown-text">HedgeAbove - Finance Analytics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./medrev.html">
 <span class="dropdown-text">MedScrape - Literature Review</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./ma206_course.html">
 <span class="dropdown-text">MA206 - Probability &amp; Statistics</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./code_annex.html"> 
<span class="menu-text">Code Examples</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/lonespear"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">GitHub</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#key-features" id="toc-key-features" class="nav-link" data-scroll-target="#key-features">Key Features</a>
  <ul class="collapse">
  <li><a href="#advanced-image-preprocessing" id="toc-advanced-image-preprocessing" class="nav-link" data-scroll-target="#advanced-image-preprocessing">1. Advanced Image Preprocessing</a></li>
  <li><a href="#intelligent-fiber-detection" id="toc-intelligent-fiber-detection" class="nav-link" data-scroll-target="#intelligent-fiber-detection">2. Intelligent Fiber Detection</a></li>
  <li><a href="#network-reconstruction" id="toc-network-reconstruction" class="nav-link" data-scroll-target="#network-reconstruction">3. Network Reconstruction</a></li>
  <li><a href="#quantitative-analysis" id="toc-quantitative-analysis" class="nav-link" data-scroll-target="#quantitative-analysis">4. Quantitative Analysis</a></li>
  <li><a href="#interactive-streamlit-interface" id="toc-interactive-streamlit-interface" class="nav-link" data-scroll-target="#interactive-streamlit-interface">5. Interactive Streamlit Interface</a></li>
  <li><a href="#visualization-suite" id="toc-visualization-suite" class="nav-link" data-scroll-target="#visualization-suite">6. Visualization Suite</a></li>
  </ul></li>
  <li><a href="#technical-implementation" id="toc-technical-implementation" class="nav-link" data-scroll-target="#technical-implementation">Technical Implementation</a>
  <ul class="collapse">
  <li><a href="#core-technologies" id="toc-core-technologies" class="nav-link" data-scroll-target="#core-technologies">Core Technologies</a></li>
  <li><a href="#system-architecture" id="toc-system-architecture" class="nav-link" data-scroll-target="#system-architecture">System Architecture</a></li>
  <li><a href="#project-structure" id="toc-project-structure" class="nav-link" data-scroll-target="#project-structure">Project Structure</a></li>
  </ul></li>
  <li><a href="#use-cases" id="toc-use-cases" class="nav-link" data-scroll-target="#use-cases">Use Cases</a>
  <ul class="collapse">
  <li><a href="#materials-science-research" id="toc-materials-science-research" class="nav-link" data-scroll-target="#materials-science-research">Materials Science Research</a></li>
  <li><a href="#quality-control" id="toc-quality-control" class="nav-link" data-scroll-target="#quality-control">Quality Control</a></li>
  <li><a href="#academic-applications" id="toc-academic-applications" class="nav-link" data-scroll-target="#academic-applications">Academic Applications</a></li>
  </ul></li>
  <li><a href="#installation-usage" id="toc-installation-usage" class="nav-link" data-scroll-target="#installation-usage">Installation &amp; Usage</a>
  <ul class="collapse">
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a></li>
  <li><a href="#running-the-application" id="toc-running-the-application" class="nav-link" data-scroll-target="#running-the-application">Running the Application</a></li>
  <li><a href="#programmatic-usage" id="toc-programmatic-usage" class="nav-link" data-scroll-target="#programmatic-usage">Programmatic Usage</a></li>
  </ul></li>
  <li><a href="#performance" id="toc-performance" class="nav-link" data-scroll-target="#performance">Performance</a>
  <ul class="collapse">
  <li><a href="#computational-complexity" id="toc-computational-complexity" class="nav-link" data-scroll-target="#computational-complexity">Computational Complexity</a></li>
  <li><a href="#typical-processing-times" id="toc-typical-processing-times" class="nav-link" data-scroll-target="#typical-processing-times">Typical Processing Times</a></li>
  </ul></li>
  <li><a href="#limitations-future-work" id="toc-limitations-future-work" class="nav-link" data-scroll-target="#limitations-future-work">Limitations &amp; Future Work</a>
  <ul class="collapse">
  <li><a href="#current-limitations" id="toc-current-limitations" class="nav-link" data-scroll-target="#current-limitations">Current Limitations</a></li>
  <li><a href="#planned-enhancements" id="toc-planned-enhancements" class="nav-link" data-scroll-target="#planned-enhancements">Planned Enhancements</a></li>
  </ul></li>
  <li><a href="#research-applications" id="toc-research-applications" class="nav-link" data-scroll-target="#research-applications">Research Applications</a></li>
  <li><a href="#technical-documentation" id="toc-technical-documentation" class="nav-link" data-scroll-target="#technical-documentation">Technical Documentation</a>
  <ul class="collapse">
  <li><a href="#key-algorithms" id="toc-key-algorithms" class="nav-link" data-scroll-target="#key-algorithms">Key Algorithms</a></li>
  </ul></li>
  <li><a href="#contributing" id="toc-contributing" class="nav-link" data-scroll-target="#contributing">Contributing</a></li>
  <li><a href="#citation" id="toc-citation" class="nav-link" data-scroll-target="#citation">Citation</a></li>
  <li><a href="#contact" id="toc-contact" class="nav-link" data-scroll-target="#contact">Contact</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">fiberL: Computer Vision for Fiber Analysis</h1>
<p class="subtitle lead">Advanced SEM Image Processing for Fiber Network Characterization</p>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>fiberL is a specialized computer vision application designed to automatically analyze Scanning Electron Microscope (SEM) images of fiber networks. It performs sophisticated image processing, fiber detection, network reconstruction, and quantitative analysis to extract meaningful structural properties from complex fiber assemblies.</p>
<p><strong>Repository:</strong> <a href="https://github.com/lonespear/fiberL">github.com/lonespear/fiberL</a></p>
<hr>
</section>
<section id="key-features" class="level2">
<h2 class="anchored" data-anchor-id="key-features">Key Features</h2>
<section id="advanced-image-preprocessing" class="level3">
<h3 class="anchored" data-anchor-id="advanced-image-preprocessing">1. Advanced Image Preprocessing</h3>
<p>The application employs state-of-the-art image enhancement techniques:</p>
<ul>
<li><strong>Anisotropic Diffusion Filtering</strong>: Noise reduction while preserving edges using Perona-Malik equations</li>
<li><strong>Coherence-Enhanced Diffusion</strong>: Follows fiber orientations for structure-aware smoothing</li>
<li><strong>Morphological Top-Hat Transform</strong>: Background removal and contrast enhancement</li>
<li><strong>Multi-Stage Thresholding</strong>: Binary thresholding combined with Canny edge detection</li>
<li><strong>Skeletonization</strong>: Extracts fiber centerlines for precise measurement</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example preprocessing workflow</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_image(image):</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Anisotropic diffusion</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    smoothed <span class="op">=</span> anisotropic_diffusion(image, iterations<span class="op">=</span><span class="dv">10</span>, kappa<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Coherence-enhanced diffusion</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    enhanced <span class="op">=</span> coherence_diffusion(smoothed, alpha<span class="op">=</span><span class="fl">0.01</span>, iterations<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Top-hat transform</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    tophat <span class="op">=</span> morphology.white_tophat(enhanced, selem<span class="op">=</span>morphology.disk(<span class="dv">15</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Thresholding</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    binary <span class="op">=</span> threshold_otsu(tophat)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Skeletonization</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    skeleton <span class="op">=</span> morphology.skeletonize(binary)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> skeleton</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="intelligent-fiber-detection" class="level3">
<h3 class="anchored" data-anchor-id="intelligent-fiber-detection">2. Intelligent Fiber Detection</h3>
<p>Uses advanced morphological operations to identify fiber network topology:</p>
<ul>
<li><strong>Branch Point Detection</strong>: 17 specialized kernels for T-junctions, Y-junctions, and crossings</li>
<li><strong>Small Segment Pruning</strong>: Removes noise artifacts</li>
<li><strong>Fiber Tip Detection</strong>: Identifies fiber endpoints</li>
<li><strong>Hit-or-Miss Transforms</strong>: Pattern matching for junction types</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Branch point detection kernels</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>T_JUNCTION_KERNELS <span class="op">=</span> [</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    np.array([[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>], [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>]]),  <span class="co"># T-top</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    np.array([[<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>], [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>]]),  <span class="co"># T-bottom</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... 15 more rotation variants</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="network-reconstruction" class="level3">
<h3 class="anchored" data-anchor-id="network-reconstruction">3. Network Reconstruction</h3>
<p>Sophisticated graph-based algorithms reconstruct the complete fiber network:</p>
<ul>
<li><strong>Intersection Association</strong>: Links fibers at branch points using cosine similarity</li>
<li><strong>Edge Connectivity Analysis</strong>: Determines fiber continuity through junctions</li>
<li><strong>Tip-to-Tip Association</strong>: Connects broken fibers based on proximity and orientation</li>
<li><strong>Curvature-Aware Merging</strong>: Uses PCA to evaluate fiber curvature for intelligent merging</li>
</ul>
<p><strong>Algorithm:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reconstruct_network(skeleton):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Detect branch points and tips</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    branch_points <span class="op">=</span> detect_branches(skeleton)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    tips <span class="op">=</span> detect_tips(skeleton)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Extract fiber segments</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    segments <span class="op">=</span> extract_segments(skeleton, branch_points)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Associate segments at intersections</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> branch <span class="kw">in</span> branch_points:</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        edges <span class="op">=</span> get_connected_edges(branch, segments)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Merge edges with similar orientation (cosine similarity)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        merged <span class="op">=</span> merge_by_orientation(edges, threshold<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Connect broken fibers</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tip1, tip2 <span class="kw">in</span> itertools.combinations(tips, <span class="dv">2</span>):</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> should_connect(tip1, tip2):</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>            connect_fibers(tip1, tip2)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> reconstructed_network</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="quantitative-analysis" class="level3">
<h3 class="anchored" data-anchor-id="quantitative-analysis">4. Quantitative Analysis</h3>
<p>Extracts comprehensive quantitative metrics:</p>
<section id="fiber-length" class="level4">
<h4 class="anchored" data-anchor-id="fiber-length">Fiber Length</h4>
<ul>
<li><strong>Arc Length Measurement</strong>: Follows fiber curvature for accurate length</li>
<li><strong>Calibrated Units</strong>: Converts pixels to physical units (nm, μm, mm)</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_fiber_length(fiber_coords, scale_factor):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate arc length of fiber</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    fiber_coords : array</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">        (N, 2) array of fiber pixel coordinates</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">    scale_factor : float</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Microns per pixel</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">    length : float</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Fiber length in microns</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> np.sqrt(np.<span class="bu">sum</span>(np.diff(fiber_coords, axis<span class="op">=</span><span class="dv">0</span>)<span class="op">**</span><span class="dv">2</span>, axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    length_pixels <span class="op">=</span> np.<span class="bu">sum</span>(distances)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    length_microns <span class="op">=</span> length_pixels <span class="op">*</span> scale_factor</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> length_microns</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="orientation-analysis" class="level4">
<h4 class="anchored" data-anchor-id="orientation-analysis">Orientation Analysis</h4>
<ul>
<li><strong>PCA-Based Directional Analysis</strong>: Principal component analysis for fiber direction</li>
<li><strong>Angle Distribution</strong>: 0-180° orientation mapping</li>
<li><strong>Rose Diagrams</strong>: Circular histograms for orientation visualization</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_fiber_orientation(fiber_coords):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate fiber orientation using PCA</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    angle : float</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Orientation angle in degrees (0-180)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    pca.fit(fiber_coords)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get principal component direction</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    direction <span class="op">=</span> pca.components_[<span class="dv">0</span>]</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    angle <span class="op">=</span> np.arctan2(direction[<span class="dv">1</span>], direction[<span class="dv">0</span>])</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to 0-180 range</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    angle_degrees <span class="op">=</span> np.degrees(angle) <span class="op">%</span> <span class="dv">180</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> angle_degrees</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="persistence-length" class="level4">
<h4 class="anchored" data-anchor-id="persistence-length">Persistence Length</h4>
<ul>
<li><strong>Tangent Correlation Analysis</strong>: Measures fiber stiffness</li>
<li><strong>Polymer Physics Metric</strong>: Characterizes mechanical properties</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_persistence_length(fiber_coords, scale_factor):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate persistence length via tangent correlation</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Persistence length (Lp) characterizes the length scale</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">    over which a fiber remains straight.</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Formula: &lt;cos(θ(s))&gt; = exp(-s/Lp)</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate tangent vectors along fiber</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    tangents <span class="op">=</span> np.diff(fiber_coords, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    tangents <span class="op">=</span> tangents <span class="op">/</span> np.linalg.norm(tangents, axis<span class="op">=</span><span class="dv">1</span>, keepdims<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate correlation as function of arc length</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    correlations <span class="op">=</span> []</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    arc_lengths <span class="op">=</span> []</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> separation <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(tangents)):</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        cos_angles <span class="op">=</span> np.<span class="bu">sum</span>(tangents[:<span class="op">-</span>separation] <span class="op">*</span> tangents[separation:], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        correlations.append(np.mean(cos_angles))</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        arc_lengths.append(separation <span class="op">*</span> scale_factor)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit exponential: &lt;cos(θ)&gt; = exp(-s/Lp)</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> exponential(s, Lp):</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.exp(<span class="op">-</span>s <span class="op">/</span> Lp)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    popt, _ <span class="op">=</span> curve_fit(exponential, arc_lengths, correlations)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    persistence_length <span class="op">=</span> popt[<span class="dv">0</span>]</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> persistence_length</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="lambda-coefficient" class="level4">
<h4 class="anchored" data-anchor-id="lambda-coefficient">Lambda Coefficient</h4>
<ul>
<li><strong>Stiffness Ratio</strong>: log(persistence length) / actual length</li>
<li><strong>Dimensionless Metric</strong>: Compares intrinsic stiffness to fiber geometry</li>
</ul>
</section>
</section>
<section id="interactive-streamlit-interface" class="level3">
<h3 class="anchored" data-anchor-id="interactive-streamlit-interface">5. Interactive Streamlit Interface</h3>
<p>User-friendly web application with:</p>
<ul>
<li><strong>Scale Calibration Tool</strong>: Point-and-click distance measurement</li>
<li><strong>ROI Cropping</strong>: Select regions of interest with preview</li>
<li><strong>Parameter Tuning</strong>: 17+ adjustable processing parameters
<ul>
<li>Diffusion iterations and constants</li>
<li>Threshold values</li>
<li>Pruning lengths</li>
<li>Association thresholds</li>
</ul></li>
<li><strong>Real-Time Processing</strong>: Immediate visual feedback</li>
<li><strong>Batch Processing</strong>: Analyze multiple images</li>
</ul>
<p><strong>Interface Workflow:</strong></p>
<pre><code>1. Upload SEM Image
   ↓
2. Scale Calibration (optional)
   - Click two points
   - Enter known distance
   ↓
3. ROI Selection (optional)
   - Draw bounding box
   - Preview cropped region
   ↓
4. Parameter Adjustment
   - Tune preprocessing
   - Set detection thresholds
   ↓
5. Process &amp; Analyze
   - View color-coded network
   - Export statistics</code></pre>
</section>
<section id="visualization-suite" class="level3">
<h3 class="anchored" data-anchor-id="visualization-suite">6. Visualization Suite</h3>
<p>Comprehensive visual output:</p>
<ul>
<li><strong>Color-Coded Networks</strong>: Fibers colored by length or randomly</li>
<li><strong>Length Histograms</strong>: Distribution analysis</li>
<li><strong>Rose Diagrams</strong>: Orientation visualization</li>
<li><strong>Scatter Plots</strong>: Length vs.&nbsp;angle relationships</li>
<li><strong>Multi-Panel Summaries</strong>: Combined figure output</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example visualization code</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> visualize_results(fibers_df):</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Length histogram</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>,<span class="dv">0</span>].hist(fibers_df[<span class="st">'length'</span>], bins<span class="op">=</span><span class="dv">30</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'Fiber Length (μm)'</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'Count'</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rose diagram</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    plot_rose_diagram(fibers_df[<span class="st">'orientation'</span>], ax<span class="op">=</span>axes[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Length vs. Angle</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>,<span class="dv">0</span>].scatter(fibers_df[<span class="st">'orientation'</span>], fibers_df[<span class="st">'length'</span>])</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'Orientation (degrees)'</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">1</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'Length (μm)'</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Color-coded network</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    plot_fiber_network(fibers_df, ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">1</span>], color_by<span class="op">=</span><span class="st">'length'</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="technical-implementation" class="level2">
<h2 class="anchored" data-anchor-id="technical-implementation">Technical Implementation</h2>
<section id="core-technologies" class="level3">
<h3 class="anchored" data-anchor-id="core-technologies">Core Technologies</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 35%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th>Component</th>
<th>Technology</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Image Processing</td>
<td>OpenCV, scikit-image</td>
<td>Morphological operations, filtering</td>
</tr>
<tr class="even">
<td>Numerical Computing</td>
<td>NumPy, SciPy</td>
<td>Array operations, optimization</td>
</tr>
<tr class="odd">
<td>Machine Learning</td>
<td>scikit-learn</td>
<td>PCA for orientation analysis</td>
</tr>
<tr class="even">
<td>Visualization</td>
<td>Matplotlib, Seaborn</td>
<td>Statistical plots</td>
</tr>
<tr class="odd">
<td>Web Interface</td>
<td>Streamlit</td>
<td>Interactive application</td>
</tr>
<tr class="even">
<td>Data Management</td>
<td>Pandas</td>
<td>Structured data handling</td>
</tr>
</tbody>
</table>
</section>
<section id="system-architecture" class="level3">
<h3 class="anchored" data-anchor-id="system-architecture">System Architecture</h3>
<pre><code>┌─────────────────────────────────────┐
│         Streamlit UI                │
│  (Parameter Input &amp; Visualization)  │
└──────────────┬──────────────────────┘
               │
               ↓
┌─────────────────────────────────────┐
│       fiberL Core Engine            │
├─────────────────────────────────────┤
│  • Image Preprocessing              │
│  • Fiber Detection                  │
│  • Network Reconstruction           │
│  • Quantitative Analysis            │
└──────────────┬──────────────────────┘
               │
               ↓
┌─────────────────────────────────────┐
│     Computer Vision Backends        │
│  (OpenCV, scikit-image, NumPy)      │
└─────────────────────────────────────┘</code></pre>
</section>
<section id="project-structure" class="level3">
<h3 class="anchored" data-anchor-id="project-structure">Project Structure</h3>
<pre><code>fiberL/
├── fiberL.py                  # Core analysis engine (1,177 lines)
│   ├── UnionFind class        # Disjoint set data structure
│   ├── Image preprocessing    # Diffusion, morphology
│   ├── Skeletonization        # Centerline extraction
│   ├── fiberL class          # Main analyzer
│   │   ├── detect_branches()
│   │   ├── reconstruct_network()
│   │   ├── calculate_metrics()
│   │   └── visualize()
│   └── Statistical analysis   # Summary statistics
│
├── app.py                     # Streamlit web interface
│   ├── File upload
│   ├── Scale calibration
│   ├── ROI cropping
│   ├── Parameter controls
│   └── Results display
│
├── requirements.txt           # Python dependencies
│   ├── opencv-python&gt;=4.5.0
│   ├── scikit-image&gt;=0.18.0
│   ├── streamlit&gt;=1.10.0
│   ├── numpy&gt;=1.20.0
│   ├── scipy&gt;=1.7.0
│   ├── pandas&gt;=1.3.0
│   ├── matplotlib&gt;=3.4.0
│   └── seaborn&gt;=0.11.0
│
└── .git/                      # Version control</code></pre>
<hr>
</section>
</section>
<section id="use-cases" class="level2">
<h2 class="anchored" data-anchor-id="use-cases">Use Cases</h2>
<section id="materials-science-research" class="level3">
<h3 class="anchored" data-anchor-id="materials-science-research">Materials Science Research</h3>
<ul>
<li>Characterize electrospun nanofiber mats</li>
<li>Analyze polymer fiber networks</li>
<li>Study textile microstructure</li>
<li>Investigate biological fibrous materials (collagen, cellulose)</li>
</ul>
</section>
<section id="quality-control" class="level3">
<h3 class="anchored" data-anchor-id="quality-control">Quality Control</h3>
<ul>
<li>Monitor fiber production consistency</li>
<li>Detect manufacturing defects</li>
<li>Quantify batch-to-batch variation</li>
<li>Validate material specifications</li>
</ul>
</section>
<section id="academic-applications" class="level3">
<h3 class="anchored" data-anchor-id="academic-applications">Academic Applications</h3>
<ul>
<li>Undergraduate research projects</li>
<li>Graduate thesis work</li>
<li>Publication-quality quantitative analysis</li>
<li>Teaching image processing concepts</li>
</ul>
<hr>
</section>
</section>
<section id="installation-usage" class="level2">
<h2 class="anchored" data-anchor-id="installation-usage">Installation &amp; Usage</h2>
<section id="installation" class="level3">
<h3 class="anchored" data-anchor-id="installation">Installation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clone repository</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/lonespear/fiberL.git</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> fiberL</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Install dependencies</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="running-the-application" class="level3">
<h3 class="anchored" data-anchor-id="running-the-application">Running the Application</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch Streamlit interface</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">streamlit</span> run app.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="programmatic-usage" class="level3">
<h3 class="anchored" data-anchor-id="programmatic-usage">Programmatic Usage</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fiberL <span class="im">import</span> fiberL</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load image</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>image <span class="op">=</span> cv2.imread(<span class="st">'fiber_image.tif'</span>, cv2.IMREAD_GRAYSCALE)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize analyzer</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>analyzer <span class="op">=</span> fiberL(</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    image<span class="op">=</span>image,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    scale_factor<span class="op">=</span><span class="fl">0.5</span>,  <span class="co"># microns per pixel</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    diffusion_iterations<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    prune_length<span class="op">=</span><span class="dv">5</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Process image</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>analyzer.process()</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Get results</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> analyzer.get_statistics()</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of fibers: </span><span class="sc">{</span>stats[<span class="st">'count'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean length: </span><span class="sc">{</span>stats[<span class="st">'mean_length'</span>]<span class="sc">:.2f}</span><span class="ss"> μm"</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean persistence length: </span><span class="sc">{</span>stats[<span class="st">'mean_persistence'</span>]<span class="sc">:.2f}</span><span class="ss"> μm"</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>analyzer.plot_results()</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Export data</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>analyzer.export_csv(<span class="st">'fiber_data.csv'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="performance" class="level2">
<h2 class="anchored" data-anchor-id="performance">Performance</h2>
<section id="computational-complexity" class="level3">
<h3 class="anchored" data-anchor-id="computational-complexity">Computational Complexity</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Operation</th>
<th>Time Complexity</th>
<th>Space Complexity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Preprocessing</td>
<td>O(n²)</td>
<td>O(n²)</td>
</tr>
<tr class="even">
<td>Skeletonization</td>
<td>O(n² log n)</td>
<td>O(n²)</td>
</tr>
<tr class="odd">
<td>Branch Detection</td>
<td>O(n²)</td>
<td>O(n)</td>
</tr>
<tr class="even">
<td>Network Reconstruction</td>
<td>O(m²)</td>
<td>O(m)</td>
</tr>
<tr class="odd">
<td>Persistence Length</td>
<td>O(m³)</td>
<td>O(m)</td>
</tr>
</tbody>
</table>
<p>Where n = image dimensions, m = number of fiber points</p>
</section>
<section id="typical-processing-times" class="level3">
<h3 class="anchored" data-anchor-id="typical-processing-times">Typical Processing Times</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Image Size</th>
<th>Fiber Count</th>
<th>Processing Time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>512×512</td>
<td>~50</td>
<td>~2 seconds</td>
</tr>
<tr class="even">
<td>1024×1024</td>
<td>~100</td>
<td>~8 seconds</td>
</tr>
<tr class="odd">
<td>2048×2048</td>
<td>~200</td>
<td>~30 seconds</td>
</tr>
<tr class="even">
<td>4096×4096</td>
<td>~500</td>
<td>~2 minutes</td>
</tr>
</tbody>
</table>
<p><em>Tested on Intel i7-9700K, 32GB RAM</em></p>
<hr>
</section>
</section>
<section id="limitations-future-work" class="level2">
<h2 class="anchored" data-anchor-id="limitations-future-work">Limitations &amp; Future Work</h2>
<section id="current-limitations" class="level3">
<h3 class="anchored" data-anchor-id="current-limitations">Current Limitations</h3>
<ul>
<li>Requires high-contrast SEM images</li>
<li>Struggles with highly overlapping fibers</li>
<li>Manual parameter tuning sometimes needed</li>
<li>2D analysis only (no depth information)</li>
</ul>
</section>
<section id="planned-enhancements" class="level3">
<h3 class="anchored" data-anchor-id="planned-enhancements">Planned Enhancements</h3>
<ul>
<li>Deep learning-based segmentation</li>
<li>3D reconstruction from image stacks</li>
<li>Automated parameter optimization</li>
<li>Batch processing improvements</li>
<li>Export to standard formats (CSV, HDF5, JSON)</li>
<li>Integration with image databases</li>
</ul>
<hr>
</section>
</section>
<section id="research-applications" class="level2">
<h2 class="anchored" data-anchor-id="research-applications">Research Applications</h2>
<p>This tool has been used in research investigating:</p>
<ul>
<li><strong>Polymer Science</strong>: Electrospun nanofiber characterization</li>
<li><strong>Tissue Engineering</strong>: Scaffold microstructure analysis</li>
<li><strong>Materials Testing</strong>: Mechanical property prediction from structure</li>
<li><strong>Biomimetics</strong>: Natural fiber network quantification</li>
</ul>
<hr>
</section>
<section id="technical-documentation" class="level2">
<h2 class="anchored" data-anchor-id="technical-documentation">Technical Documentation</h2>
<section id="key-algorithms" class="level3">
<h3 class="anchored" data-anchor-id="key-algorithms">Key Algorithms</h3>
<section id="anisotropic-diffusion-perona-malik" class="level4">
<h4 class="anchored" data-anchor-id="anisotropic-diffusion-perona-malik">Anisotropic Diffusion (Perona-Malik)</h4>
<p><span class="math display">\[\frac{\partial I}{\partial t} = \text{div}(c(|\nabla I|) \nabla I)\]</span></p>
<p>Where diffusion coefficient: <span class="math display">\[c(|\nabla I|) = \exp\left(-\left(\frac{|\nabla I|}{K}\right)^2\right)\]</span></p>
</section>
<section id="persistence-length-1" class="level4">
<h4 class="anchored" data-anchor-id="persistence-length-1">Persistence Length</h4>
<p><span class="math display">\[\langle \cos\theta(s) \rangle = \exp\left(-\frac{s}{L_p}\right)\]</span></p>
<p>Where: - <span class="math inline">\(s\)</span> = arc length along fiber - <span class="math inline">\(L_p\)</span> = persistence length - <span class="math inline">\(\theta(s)\)</span> = angle at position <span class="math inline">\(s\)</span></p>
</section>
<section id="cosine-similarity-orientation-matching" class="level4">
<h4 class="anchored" data-anchor-id="cosine-similarity-orientation-matching">Cosine Similarity (Orientation Matching)</h4>
<p><span class="math display">\[\text{similarity} = \frac{\mathbf{v}_1 \cdot \mathbf{v}_2}{|\mathbf{v}_1| |\mathbf{v}_2|}\]</span></p>
<hr>
</section>
</section>
</section>
<section id="contributing" class="level2">
<h2 class="anchored" data-anchor-id="contributing">Contributing</h2>
<p>Contributions welcome! Areas for improvement: - Algorithm optimization - Additional quantitative metrics - Enhanced visualization options - Documentation improvements - Test coverage</p>
<hr>
</section>
<section id="citation" class="level2">
<h2 class="anchored" data-anchor-id="citation">Citation</h2>
<p>If you use fiberL in your research, please cite:</p>
<pre><code>Day, J. (2025). fiberL: Computer Vision for Fiber Network Analysis.
GitHub repository: https://github.com/lonespear/fiberL</code></pre>
<hr>
</section>
<section id="contact" class="level2">
<h2 class="anchored" data-anchor-id="contact">Contact</h2>
<p><strong>Jonathan Day</strong> Department of Mathematical Sciences United States Military Academy West Point, NY</p>
<p><strong>Email</strong>: jonathan.day@westpoint.edu <strong>GitHub</strong>: <a href="https://github.com/lonespear">github.com/lonespear</a></p>
<hr>
<p><a href="./index.html" class="btn btn-secondary">← Back to Projects</a> <a href="https://github.com/lonespear/fiberL" class="btn btn-primary" target="_blank">View on GitHub</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>